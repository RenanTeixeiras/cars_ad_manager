<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoPublish - Gerenciar Anúncios</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
    <style>

/* Adicione este código dentro do bloco <style> existente */
/* Estilos para o modal */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.5);
}

.modal-content {
    background-color: white;
    margin: 50px auto;
    max-width: 800px;
    width: 90%;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    animation: modalFadeIn 0.3s;
}

@keyframes modalFadeIn {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-header {
    padding: 15px 20px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h2 {
    margin: 0;
    font-size: 1.5rem;
    color: var(--dark-gray);
    display: flex;
    align-items: center;
}

.modal-header h2 i {
    margin-right: 10px;
    color: var(--primary-color);
}

.close-modal {
    font-size: 24px;
    font-weight: bold;
    color: #aaa;
    cursor: pointer;
    transition: color 0.3s;
}

.close-modal:hover {
    color: var(--accent-color);
}

.modal-body {
    padding: 20px;
    max-height: 70vh;
    overflow-y: auto;
}

.modal-footer {
    padding: 15px 20px;
    border-top: 1px solid #eee;
    text-align: right;
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

/* Estilo para o botão de cancelar */
#cancelar-edicao {
    background-color: #f5f5f5;
    color: var(--text-color);
}

#cancelar-edicao:hover {
    background-color: #e0e0e0;
}

/* Estilo para a mensagem de loading */
.loading-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.8);
    z-index: 2000;
    justify-content: center;
    align-items: center;
}

.loading-spinner {
    width: 50px;
    height: 50px;
    border: 5px solid #f3f3f3;
    border-top: 5px solid var(--primary-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
} 

.anuncios-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 30px;
}

.anuncio-card {
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

.anuncio-imagem {
    height: 180px;
    overflow: hidden;
    position: relative;
}

.anuncio-imagem img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.anuncio-sem-imagem {
    height: 180px;
    background-color: #f5f5f5;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #aaa;
}

.anuncio-conteudo {
    padding: 15px;
}

.anuncio-titulo {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 5px;
    color: var(--dark-gray);
}

.anuncio-preco {
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 10px;
}

.anuncio-detalhes {
    font-size: 0.9rem;
    color: #666;
    margin-bottom: 15px;
}

.anuncio-detalhes span {
    margin-right: 15px;
}

.anuncio-status {
    display: inline-block;
    padding: 3px 10px;
    border-radius: 20px;
    font-size: 0.8rem;
    margin-bottom: 10px;
}

.status-publicado {
    background-color: rgba(39, 174, 96, 0.1);
    color: var(--success-color);
}

.status-rascunho {
    background-color: rgba(241, 196, 15, 0.1);
    color: #f1c40f;
}

.anuncio-acoes {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
    border-top: 1px solid #eee;
    padding-top: 15px;
}

.anuncio-acao {
    padding: 5px 10px;
    font-size: 0.9rem;
    color: var(--text-color);
    cursor: pointer;
    transition: color 0.3s;
}

.anuncio-acao:hover {
    color: var(--primary-color);
}

.filtros {
    display: flex;
    margin-bottom: 20px;
}

.filtro-btn {
    margin-right: 10px;
    padding: 8px 15px;
    border-radius: 4px;
    background-color: #f5f5f5;
    color: var(--text-color);
    cursor: pointer;
    transition: background-color 0.3s;
}

.filtro-btn.ativo {
    background-color: var(--primary-color);
    color: white;
}

.sem-anuncios {
    text-align: center;
    padding: 50px 0;
    color: #666;
}

.sem-anuncios i {
    font-size: 3rem;
    margin-bottom: 20px;
    color: #ddd;
}

.voltar-btn {
    margin-bottom: 20px;
    display: inline-flex;
    align-items: center;
    color: var(--text-color);
    text-decoration: none;
    transition: color 0.3s;
}

.voltar-btn:hover {
    color: var(--primary-color);
}

.voltar-btn i {
    margin-right: 8px;
}

/* Estilos para a seção de ficha técnica */
.section-title {
    font-size: 1.2rem;
    color: var(--dark-gray);
    margin: 25px 0 15px;
    padding-bottom: 8px;
    border-bottom: 1px solid #eee;
    display: flex;
    align-items: center;
}

.section-title i {
    margin-right: 10px;
    color: var(--primary-color);
}

.opcionais-container {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-top: 10px;
}

.opcional-item {
    display: flex;
    align-items: center;
}

.opcional-check {
    margin-right: 8px;
}

@media (max-width: 768px) {
    .opcionais-container {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 480px) {
    .opcionais-container {
        grid-template-columns: 1fr;
    }
}

/* Estilos aprimorados para badges de plataformas no card de anúncios */
.anuncio-plataformas {
    margin-top: 10px;
    border-top: 1px dotted #eee;
    padding-top: 10px;
}

.plataformas-badges {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
}

.plataforma-badge {
    background-color: #f9f9f9;
    border-radius: 20px;
    padding: 4px 10px;
    display: flex;
    align-items: center;
    border: 1px solid #eee;
    font-size: 0.75rem;
    color: #333;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}

.plataforma-badge-logo {
    width: 16px;
    height: 16px;
    object-fit: contain;
    margin-right: 5px;
}

.plataforma-badge-name {
    font-weight: 500;
}

.sem-plataformas {
    color: #999;
    font-size: 0.85rem;
    font-style: italic;
}

.sem-plataformas i {
    margin-right: 4px;
}

/* Estilos específicos para cada plataforma */
.plataforma-badge-webmotors {
    background-color: rgba(224, 30, 38, 0.1);
    border-color: rgba(224, 30, 38, 0.3);
    color: #c01a21;
}

.plataforma-badge-socarrao {
    background-color: rgba(0, 123, 255, 0.1);
    border-color: rgba(0, 123, 255, 0.3);
    color: #0056b3;
}

.plataforma-badge-olx {
    background-color: rgba(116, 0, 184, 0.1);
    border-color: rgba(116, 0, 184, 0.3);
    color: #6200a0;
}

.plataforma-badge-mercadolivre {
    background-color: rgba(255, 223, 0, 0.1);
    border-color: rgba(255, 223, 0, 0.3);
    color: #a49500;
}

.plataforma-badge-icarros {
    background-color: rgba(249, 125, 1, 0.1);
    border-color: rgba(249, 125, 1, 0.3);
    color: #c25600;
}

/* Estilos para os elementos de plataforma no formulário principal */
.plataformas-descricao {
    margin-bottom: 15px;
    color: #666;
}

.plataformas-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}

.plataforma-item {
    position: relative;
}

.plataforma-check {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
}

.plataforma-label {
    display: flex;
    align-items: center;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.plataforma-check:checked + .plataforma-label {
    border-color: var(--primary-color);
    background-color: rgba(52, 152, 219, 0.05);
    box-shadow: 0 2px 8px rgba(52, 152, 219, 0.15);
}

.plataforma-logo {
    width: 50px;
    height: 50px;
    object-fit: contain;
    margin-right: 15px;
}

.plataforma-info {
    display: flex;
    flex-direction: column;
}

.plataforma-nome {
    font-weight: 600;
    margin-bottom: 5px;
}

.plataforma-preco {
    font-size: 0.9rem;
    color: #666;
}

.plataformas-resumo {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #f9f9f9;
    padding: 15px;
    border-radius: 8px;
    margin-top: 10px;
}

.plataformas-total {
    font-weight: 600;
}

.plataformas-valor-total {
    color: var(--primary-color);
}

.plataformas-info {
    font-size: 0.9rem;
    color: #666;
}

.plataformas-info i {
    margin-right: 5px;
    color: var(--primary-color);
}

/* Efeito hover nas plataformas */
.plataforma-label:hover {
    background-color: #f5f5f5;
    transform: translateY(-2px);
}

/* Quando a plataforma estiver checada E hover */
.plataforma-check:checked + .plataforma-label:hover {
    background-color: rgba(52, 152, 219, 0.1);
}

    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-car"></i> AutoPublish
            </div>
            <nav>
                <ul>
                    <li><a href="/">Criar Anúncio</a></li>
                    <li><a href="/anuncios" class="active">Meus Anúncios</a></li>
                   
                </ul>
            </nav>
        </header>

        <a href="/" class="voltar-btn">
            <i class="fas fa-arrow-left"></i> Voltar para Criar Anúncio
        </a>

        <h1>Gerenciar Anúncios</h1>

        <div class="filtros">
            <a href="/anuncios" class="filtro-btn {{ 'ativo' if not status_filtro }}">Todos</a>
            <a href="/anuncios?status=publicado" class="filtro-btn {{ 'ativo' if status_filtro == 'publicado' }}">Publicados</a>
            <a href="/anuncios?status=rascunho" class="filtro-btn {{ 'ativo' if status_filtro == 'rascunho' }}">Rascunhos</a>
        </div>

        {% if anuncios %}
            <div class="anuncios-container">
                {% for anuncio in anuncios %}
                <div class="anuncio-card" data-anuncio-id="{{ anuncio._id }}">

                        {% if anuncio.imagens and anuncio.imagens|length > 0 %}
                            <div class="anuncio-imagem">
                                <img src="{{ anuncio.imagens[0] }}" alt="{{ anuncio.marca }} {{ anuncio.modelo }}">
                            </div>
                        {% else %}
                            <div class="anuncio-sem-imagem">
                                <i class="fas fa-car fa-3x"></i>
                            </div>
                        {% endif %}
                        
                        <div class="anuncio-conteudo">
                            <div class="anuncio-status status-{{ anuncio.status }}">
                                {{ "Publicado" if anuncio.status == "publicado" else "Rascunho" }}
                            </div>
                            
                            <div class="anuncio-titulo">{{ anuncio.marca|title }} {{ anuncio.modelo|title }} {{ anuncio.versao }}</div>
                            
                            <div class="anuncio-preco">R$ {{ "%.2f"|format(anuncio.preco)|replace(".", ",") }}</div>
                            
                            <div class="anuncio-detalhes">
                                <span><i class="fas fa-calendar-alt"></i> {{ anuncio.ano }}</span>
                                <span><i class="fas fa-tachometer-alt"></i> {{ anuncio.km }} km</span>
                            </div>

                            <div class="anuncio-plataformas">
                                {% if anuncio.plataformas_selecionadas and anuncio.plataformas_selecionadas|length > 0 %}
                                    <div class="plataformas-badges">
                                        {% for plataforma in anuncio.plataformas_selecionadas %}
                                            <div class="plataforma-badge plataforma-badge-{{ plataforma }}">
                                                <span class="plataforma-badge-name">{{ plataforma|capitalize }}</span>
                                    
                                            </div>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <div class="sem-plataformas">
                                        <i class="fas fa-info-circle"></i> Sem plataformas selecionadas
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="anuncio-acoes">
                                <a href="#" class="anuncio-acao" onclick="editarAnuncio('{{ anuncio._id }}')">
                                    <i class="fas fa-edit"></i> Editar
                                </a>
                                {% if anuncio.status == "rascunho" %}
                                    <a href="#" class="anuncio-acao" onclick="publicarAnuncio('{{ anuncio._id }}')">
                                        <i class="fas fa-paper-plane"></i> Publicar
                                    </a>
                                {% else %}
                                    <a href="#" class="anuncio-acao" onclick="despublicarAnuncio('{{ anuncio._id }}')">
                                        <i class="fas fa-pause"></i> Despublicar
                                    </a>
                                {% endif %}
                                <a href="#" class="anuncio-acao" onclick="excluirAnuncio('{{ anuncio._id }}')">
                                    <i class="fas fa-trash"></i> Excluir
                                </a>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="sem-anuncios">
                <i class="fas fa-car"></i>
                <h3>Nenhum anúncio encontrado</h3>
                <p>Você ainda não possui anúncios {{ status_filtro }}. <a href="/">Criar um novo anúncio</a>.</p>
            </div>
        {% endif %}
    </div>


    <!-- Adicione este código antes do fechamento da tag </body> em templates/anuncios.html -->
<!-- Modal para edição de anúncios -->
<div id="modal-editar" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-edit"></i> Editar Anúncio</h2>
            <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
            <form id="edit-form" enctype="multipart/form-data">
                <input type="hidden" id="edit-id">
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-marca">Marca</label>
                            <select class="form-control" id="edit-marca" required>
                                <option value="">Selecione a marca</option>
                                <option value="chevrolet">Chevrolet</option>
                                <option value="fiat">Fiat</option>
                                <option value="ford">Ford</option>
                                <option value="honda">Honda</option>
                                <option value="hyundai">Hyundai</option>
                                <option value="toyota">Toyota</option>
                                <option value="volkswagen">Volkswagen</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-modelo">Modelo</label>
                            <select class="form-control" id="edit-modelo" required>
                                <option value="">Selecione o modelo</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-ano">Ano</label>
                            <input type="number" class="form-control" id="edit-ano" min="1900" max="2025" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-versao">Versão</label>
                            <input type="text" class="form-control" id="edit-versao" placeholder="Ex: LX 1.8 Automático">
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-km">Quilometragem</label>
                            <input type="number" class="form-control" id="edit-km" min="0" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-preco">Preço (R$)</label>
                            <input type="number" class="form-control" id="edit-preco" min="0" step="0.01" required>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="edit-descricao">Descrição</label>
                    <textarea class="form-control" id="edit-descricao" rows="5" placeholder="Descreva detalhes do veículo, conservação, diferenciais..."></textarea>
                </div>

                <h3 class="section-title"><i class="fas fa-clipboard-list"></i> Ficha Técnica</h3>
    
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-combustivel">Combustível</label>
                            <select class="form-control" id="edit-combustivel">
                                <option value="">Selecione</option>
                                <option value="Gasolina">Gasolina</option>
                                <option value="Etanol">Etanol</option>
                                <option value="Flex">Flex (Gasolina/Etanol)</option>
                                <option value="Diesel">Diesel</option>
                                <option value="GNV">GNV</option>
                                <option value="Híbrido">Híbrido</option>
                                <option value="Elétrico">Elétrico</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-cambio">Câmbio</label>
                            <select class="form-control" id="edit-cambio">
                                <option value="">Selecione</option>
                                <option value="Manual">Manual</option>
                                <option value="Automático">Automático</option>
                                <option value="CVT">CVT</option>
                                <option value="Semi-automático">Semi-automático</option>
                                <option value="Automatizado">Automatizado</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-cor">Cor</label>
                            <input type="text" class="form-control" id="edit-cor" placeholder="Ex: Prata, Branco, Preto">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-portas">Número de Portas</label>
                            <select class="form-control" id="edit-portas">
                                <option value="">Selecione</option>
                                <option value="2">2 portas</option>
                                <option value="3">3 portas</option>
                                <option value="4">4 portas</option>
                                <option value="5">5 portas</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-motor">Motor</label>
                            <input type="text" class="form-control" id="edit-motor" placeholder="Ex: 1.0, 1.6, 2.0">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-potencia">Potência (cv)</label>
                            <input type="number" class="form-control" id="edit-potencia" placeholder="Ex: 116">
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-direcao">Direção</label>
                            <select class="form-control" id="edit-direcao">
                                <option value="">Selecione</option>
                                <option value="Mecânica">Mecânica</option>
                                <option value="Hidráulica">Hidráulica</option>
                                <option value="Eletro-hidráulica">Eletro-hidráulica</option>
                                <option value="Elétrica">Elétrica</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="edit-final-placa">Final da Placa</label>
                            <input type="text" class="form-control" id="edit-final-placa" maxlength="1" placeholder="Ex: 0-9">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="edit-opcionais">Opcionais</label>
                    <div class="opcionais-container">
                        <div class="opcional-item">
                            <input type="checkbox" id="edit-ar-condicionado" class="opcional-check">
                            <label for="edit-ar-condicionado">Ar Condicionado</label>
                        </div>
                        <div class="opcional-item">
                            <input type="checkbox" id="edit-vidros-eletricos" class="opcional-check">
                            <label for="edit-vidros-eletricos">Vidros Elétricos</label>
                        </div>
                        <div class="opcional-item">
                            <input type="checkbox" id="edit-travas-eletricas" class="opcional-check">
                            <label for="edit-travas-eletricas">Travas Elétricas</label>
                        </div>
                        <div class="opcional-item">
                            <input type="checkbox" id="edit-alarme" class="opcional-check">
                            <label for="edit-alarme">Alarme</label>
                        </div>
                        <div class="opcional-item">
                            <input type="checkbox" id="edit-som" class="opcional-check">
                            <label for="edit-som">Som</label>
                        </div>
                        <div class="opcional-item">
                            <input type="checkbox" id="edit-sensor-re" class="opcional-check">
                            <label for="edit-sensor-re">Sensor de Ré</label>
                        </div>
                        <div class="opcional-item">
                            <input type="checkbox" id="edit-camera-re" class="opcional-check">
                            <label for="edit-camera-re">Câmera de Ré</label>
                        </div>
                        <div class="opcional-item">
                            <input type="checkbox" id="edit-airbag" class="opcional-check">
                            <label for="edit-airbag">Airbag</label>
                        </div>
                        <div class="opcional-item">
                            <input type="checkbox" id="edit-abs" class="opcional-check">
                            <label for="edit-abs">Freios ABS</label>
                        </div>
                        <div class="opcional-item">
                            <input type="checkbox" id="edit-couro" class="opcional-check">
                            <label for="edit-couro">Bancos em Couro</label>
                        </div>
                        <div class="opcional-item">
                            <input type="checkbox" id="edit-teto-solar" class="opcional-check">
                            <label for="edit-teto-solar">Teto Solar</label>
                        </div>
                        <div class="opcional-item">
                            <input type="checkbox" id="edit-multimidia" class="opcional-check">
                            <label for="edit-multimidia">Central Multimídia</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="edit-informacoes-adicionais">Informações Adicionais</label>
                    <textarea class="form-control" id="edit-informacoes-adicionais" rows="3" placeholder="Outras informações técnicas ou observações..."></textarea>
                </div>

                <div class="form-group">
                    <label>Fotos do Veículo</label>
                    <div class="image-upload" id="edit-image-upload">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Arraste e solte ou clique para adicionar fotos</p>
                        <input type="file" id="edit-file-input" multiple accept="image/*" style="display: none;">
                    </div>
                    <div class="preview-container" id="edit-preview-container"></div>
                </div>
                <!-- Adicionar esta seção ao modal-editar em templates/anuncios.html -->
<!-- Inserir antes do grupo de formulário das imagens -->

<!-- Substitua a parte do plataformas-container no modal de edição por este código -->

<div class="form-group">
    <h3 class="section-title"><i class="fas fa-share-alt"></i> Plataformas de Anúncio</h3>
    <p class="plataformas-descricao">Selecione as plataformas onde deseja publicar seu anúncio:</p>
    
    <div class="plataformas-logos-container">
        <div class="plataforma-logo-item">
            <input type="checkbox" id="edit-webmotors" class="plataforma-check edit-plataforma">
            <label for="edit-webmotors" class="plataforma-logo-label">
                <img src="/static/images/logos/webmotors.png" alt="Webmotors" class="plataforma-logo-image">
            </label>
        </div>
        
        <div class="plataforma-logo-item">
            <input type="checkbox" id="edit-socarrao" class="plataforma-check edit-plataforma">
            <label for="edit-socarrao" class="plataforma-logo-label">
                <img src="/static/images/logos/socarrao.png" alt="Só Carrão" class="plataforma-logo-image">
            </label>
        </div>
        
        <div class="plataforma-logo-item">
            <input type="checkbox" id="edit-olx" class="plataforma-check edit-plataforma">
            <label for="edit-olx" class="plataforma-logo-label">
                <img src="/static/images/logos/olx.png" alt="OLX" class="plataforma-logo-image">
            </label>
        </div>
        
        <div class="plataforma-logo-item">
            <input type="checkbox" id="edit-mercadolivre" class="plataforma-check edit-plataforma">
            <label for="edit-mercadolivre" class="plataforma-logo-label">
                <img src="/static/images/logos/mercadolivre.png" alt="Mercado Livre" class="plataforma-logo-image">
            </label>
        </div>
        
        <div class="plataforma-logo-item">
            <input type="checkbox" id="edit-icarros" class="plataforma-check edit-plataforma">
            <label for="edit-icarros" class="plataforma-logo-label">
                <img src="/static/images/logos/icarros.png" alt="iCarros" class="plataforma-logo-image">
            </label>
        </div>
    </div>
    
    <div class="plataformas-resumo">
        <div class="plataformas-total">
            <span>Total estimado: </span>
            <span id="edit-plataformas-valor-total">R$ 0,00</span>
        </div>
        <div class="plataformas-info">
            <i class="fas fa-info-circle"></i>
            <span>Os valores serão cobrados somente após a publicação do anúncio</span>
        </div>
    </div>
</div>

<!-- Adicione este CSS ao seu bloco de estilo -->
<style>
.plataformas-logos-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin: 15px 0;
    justify-content: center;
}

.plataforma-logo-item {
    position: relative;
}

.plataforma-check {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
}

.plataforma-logo-label {
    display: block;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.plataforma-logo-image {
    width: 80px;
    height: 80px;
    object-fit: contain;
    transition: all 0.3s ease;
    filter: grayscale(70%);
    opacity: 0.6;
    border-radius: 50%;
    padding: 10px;
    background-color: #f8f8f8;
}

.plataforma-check:checked + .plataforma-logo-label .plataforma-logo-image {
    filter: grayscale(0%);
    opacity: 1;
    background-color: rgba(52, 152, 219, 0.1);
    box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.2);
    transform: scale(1.05);
}

.plataforma-logo-label:hover .plataforma-logo-image {
    filter: grayscale(30%);
    opacity: 0.9;
    transform: translateY(-5px);
}

.plataforma-check:checked + .plataforma-logo-label::after {
    content: '✓';
    position: absolute;
    bottom: -5px;
    right: -5px;
    background-color: #3498db;
    color: white;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
}
</style>

                <div class="modal-footer">
                    <button type="button" class="btn" id="cancelar-edicao">Cancelar</button>
                    <button type="button" class="btn btn-accent" id="salvar-edicao">Salvar Alterações</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Overlay de carregamento -->
<div class="loading-overlay" id="loading-overlay">
    <div class="loading-spinner"></div>
</div>


    <footer>
        <p>&copy; 2025 AutoPublish - Todos os direitos reservados</p>
    </footer>

    <script>
        function editarAnuncio(id) {
            // Implementar edição de anúncio
            alert(`Editar anúncio com ID: ${id}`);
        }
        
        function publicarAnuncio(id) {
            // Implementar publicação de anúncio
            alert(`Publicar anúncio com ID: ${id}`);
        }
        
        function despublicarAnuncio(id) {
            // Implementar despublicação de anúncio
            alert(`Despublicar anúncio com ID: ${id}`);
        }
        
        function excluirAnuncio(id) {
            if (confirm('Tem certeza que deseja excluir este anúncio?')) {
                // Implementar exclusão de anúncio
                alert(`Excluir anúncio com ID: ${id}`);
            }
        }
    </script>
    <script>
        // Variáveis globais para o modal
        let currentAnuncioId = null;
        let currentImages = [];
    
        // Função para abrir o modal de edição
        function editarAnuncio(id) {
            console.log(`Editando anúncio com ID: ${id}`);
            currentAnuncioId = id;
            
            // Mostrar o loading
            document.getElementById('loading-overlay').style.display = 'flex';
            
            // Fazer requisição para obter os dados do anúncio
            fetch(`/anuncio/${id}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Erro ao buscar anúncio: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Dados do anúncio:', data);
                    preencherFormularioEdicao(data);
                    
                    // Esconder o loading e mostrar o modal
                    document.getElementById('loading-overlay').style.display = 'none';
                    document.getElementById('modal-editar').style.display = 'block';
                })
                .catch(error => {
                    console.error('Erro ao obter dados do anúncio:', error);
                    alert('Não foi possível carregar os dados do anúncio.');
                    document.getElementById('loading-overlay').style.display = 'none';
                });
        }
    
        // Função para preencher o formulário de edição com os dados do anúncio
        function preencherFormularioEdicao(anuncio) {
            // Preencher os campos do formulário
            document.getElementById('edit-id').value = anuncio._id;
            
            // Preencher a marca e disparar o evento change para carregar os modelos
            const marcaSelect = document.getElementById('edit-marca');
            marcaSelect.value = anuncio.marca.toLowerCase();
            marcaSelect.dispatchEvent(new Event('change'));
            
            // Timeout para dar tempo dos modelos serem carregados
            setTimeout(() => {
                // Preencher o modelo
                const modeloSelect = document.getElementById('edit-modelo');
                modeloSelect.value = anuncio.modelo.toLowerCase();
                
                // Se o modelo não existir nas opções, adicionar
                if (modeloSelect.value !== anuncio.modelo.toLowerCase()) {
                    const option = document.createElement('option');
                    option.value = anuncio.modelo.toLowerCase();
                    option.text = anuncio.modelo;
                    modeloSelect.appendChild(option);
                    modeloSelect.value = anuncio.modelo.toLowerCase();
                }
            }, 300);
            
            // Preencher os outros campos
            document.getElementById('edit-ano').value = anuncio.ano || '';
            document.getElementById('edit-versao').value = anuncio.versao || '';
            document.getElementById('edit-km').value = anuncio.km || 0;
            document.getElementById('edit-preco').value = anuncio.preco || 0;
            document.getElementById('edit-descricao').value = anuncio.descricao || '';
            
            // Armazenar as imagens atuais
            currentImages = anuncio.imagens || [];
            
            // Limpar o preview de imagens
            const previewContainer = document.getElementById('edit-preview-container');
            previewContainer.innerHTML = '';
            
            // Adicionar as imagens existentes ao preview
            if (currentImages.length > 0) {
                currentImages.forEach((imagemUrl, index) => {
                    const imagePreview = document.createElement('div');
                    imagePreview.className = 'image-preview';
                    imagePreview.dataset.index = index;
                    
                    const img = document.createElement('img');
                    img.src = imagemUrl;
                    
                    const deleteButton = document.createElement('div');
                    deleteButton.className = 'delete-image';
                    deleteButton.innerHTML = '<i class="fas fa-times"></i>';
                    
                    deleteButton.addEventListener('click', function(event) {
                        event.stopPropagation();
                        // Remover a imagem do array
                        currentImages.splice(index, 1);
                        // Remover o preview
                        imagePreview.remove();
                    });
                    
                    imagePreview.appendChild(img);
                    imagePreview.appendChild(deleteButton);
                    previewContainer.appendChild(imagePreview);
                });
            }

                // Preencher campos da ficha técnica
    document.getElementById('edit-combustivel').value = anuncio.combustivel || '';
    document.getElementById('edit-cambio').value = anuncio.cambio || '';
    document.getElementById('edit-cor').value = anuncio.cor || '';
    document.getElementById('edit-portas').value = anuncio.portas || '';
    document.getElementById('edit-motor').value = anuncio.motor || '';
    document.getElementById('edit-potencia').value = anuncio.potencia || '';
    document.getElementById('edit-direcao').value = anuncio.direcao || '';
    document.getElementById('edit-final-placa').value = anuncio.final_placa || '';
    document.getElementById('edit-informacoes-adicionais').value = anuncio.informacoes_adicionais || '';
    
    // Preencher opcionais (checkboxes)
    const opcionais = anuncio.opcionais || [];
    
    // Lista de todos os IDs dos opcionais
    const checkboxesIds = [
        'edit-ar-condicionado', 'edit-vidros-eletricos', 'edit-travas-eletricas',
        'edit-alarme', 'edit-som', 'edit-sensor-re', 'edit-camera-re',
        'edit-airbag', 'edit-abs', 'edit-couro', 'edit-teto-solar', 'edit-multimidia'
    ];
    
    // Resetar todos os checkboxes
    checkboxesIds.forEach(id => {
        document.getElementById(id).checked = false;
    });
    
    // Marcar os checkboxes correspondentes aos opcionais do anúncio
    opcionais.forEach(opcional => {
        const checkboxId = `edit-${opcional.toLowerCase().replace(/\s+/g, '-')}`;
        const checkbox = document.getElementById(checkboxId);
        if (checkbox) {
            checkbox.checked = true;
        }
    });



        }
    
        // Função para salvar as alterações do anúncio
        // Função para salvar as alterações do anúncio
function salvarEdicao() {
    console.log("Iniciando salvamento de edição...");
    
    // Verificar campos obrigatórios
    const camposObrigatorios = ['edit-marca', 'edit-modelo', 'edit-ano', 'edit-km', 'edit-preco'];
    let formValido = true;
    
    camposObrigatorios.forEach(campo => {
        const elemento = document.getElementById(campo);
        if (!elemento.value.trim()) {
            elemento.classList.add('invalido');
            formValido = false;
            console.log(`Campo ${campo} inválido`);
        } else {
            elemento.classList.remove('invalido');
        }
    });
    
    if (!formValido) {
        alert('Por favor, preencha todos os campos obrigatórios.');
        return;
    }
    
    // Coletar plataformas selecionadas manualmente para garantir que estão corretas
    const plataformas = [
        { id: 'edit-webmotors', slug: 'webmotors' },
        { id: 'edit-socarrao', slug: 'socarrao' },
        { id: 'edit-olx', slug: 'olx' },
        { id: 'edit-mercadolivre', slug: 'mercadolivre' },
        { id: 'edit-icarros', slug: 'icarros' }
    ];
    
    const plataformasSelecionadas = [];
    
    plataformas.forEach(plataforma => {
        const checkbox = document.getElementById(plataforma.id);
        if (checkbox && checkbox.checked) {
            plataformasSelecionadas.push(plataforma.slug);
            console.log(`Plataforma selecionada: ${plataforma.slug}`);
        }
    });
    
    console.log("Plataformas selecionadas:", plataformasSelecionadas);
    
    // Mostrar o loading
    document.getElementById('loading-overlay').style.display = 'flex';
    
    // Criar FormData para enviar os dados
    const formData = new FormData();
    
    // Adicionar os campos do formulário
    formData.append('_id', document.getElementById('edit-id').value);
    formData.append('marca', document.getElementById('edit-marca').value);
    formData.append('modelo', document.getElementById('edit-modelo').value);
    formData.append('ano', document.getElementById('edit-ano').value);
    formData.append('versao', document.getElementById('edit-versao').value);
    formData.append('km', document.getElementById('edit-km').value);
    formData.append('preco', document.getElementById('edit-preco').value);
    formData.append('descricao', document.getElementById('edit-descricao').value);
    
    // Adicionar campos da ficha técnica ao FormData
    formData.append('combustivel', document.getElementById('edit-combustivel').value);
    formData.append('cambio', document.getElementById('edit-cambio').value);
    formData.append('cor', document.getElementById('edit-cor').value);
    formData.append('portas', document.getElementById('edit-portas').value);
    formData.append('motor', document.getElementById('edit-motor').value);
    formData.append('potencia', document.getElementById('edit-potencia').value);
    formData.append('direcao', document.getElementById('edit-direcao').value);
    formData.append('final_placa', document.getElementById('edit-final-placa').value);
    formData.append('informacoes_adicionais', document.getElementById('edit-informacoes-adicionais').value);
    
    // Coletar opcionais marcados
    const opcionais = [];
    const checkboxesIds = [
        'edit-ar-condicionado', 'edit-vidros-eletricos', 'edit-travas-eletricas',
        'edit-alarme', 'edit-som', 'edit-sensor-re', 'edit-camera-re',
        'edit-airbag', 'edit-abs', 'edit-couro', 'edit-teto-solar', 'edit-multimidia'
    ];
    
    checkboxesIds.forEach(id => {
        if (document.getElementById(id).checked) {
            // Converter id (ex: 'edit-ar-condicionado') para nome legível (ex: 'Ar Condicionado')
            const nome = id.replace('edit-', '')
                       .split('-')
                       .map(palavra => palavra.charAt(0).toUpperCase() + palavra.slice(1))
                       .join(' ');
            opcionais.push(nome);
        }
    });
    
    // Adicionar opcionais como JSON string
    formData.append('opcionais', JSON.stringify(opcionais));

    // Adicionar plataformas - IMPORTANTE
    const plataformasJSON = JSON.stringify(plataformasSelecionadas);
    console.log(`Enviando plataformas: ${plataformasJSON}`);
    formData.append('plataformas', plataformasJSON);

    // Adicionar as imagens existentes
    formData.append('imagens_existentes', JSON.stringify(currentImages));
    
    // Adicionar novas imagens, se houver
    const fileInput = document.getElementById('edit-file-input');
    if (fileInput.files.length > 0) {
        for (let i = 0; i < fileInput.files.length; i++) {
            formData.append('novas_imagens', fileInput.files[i]);
        }
    }
    
    // Verificar dados enviados
    console.log("Dados que serão enviados:");
    for (let pair of formData.entries()) {
        console.log(pair[0] + ': ' + pair[1]);
    }
    
    // Enviar os dados para o servidor
    fetch(`/atualizar_anuncio/${currentAnuncioId}`, {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`Erro na requisição: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        console.log('Resposta do servidor:', data);
        
        if (data.sucesso) {
            // Fechar o modal
            document.getElementById('modal-editar').style.display = 'none';
            
            // Mostrar mensagem de sucesso
            alert('Anúncio atualizado com sucesso!');
            
            // Recarregar a página para mostrar as mudanças
            window.location.reload();
        } else {
            alert(data.mensagem || 'Ocorreu um erro ao atualizar o anúncio.');
            document.getElementById('loading-overlay').style.display = 'none';
        }
    })
    .catch(error => {
        console.error('Erro ao atualizar anúncio:', error);
        alert('Não foi possível atualizar o anúncio. Verifique o console para mais detalhes.');
        document.getElementById('loading-overlay').style.display = 'none';
    });
}
    
        // Função para publicar anúncio
        function publicarAnuncio(id) {
            if (confirm('Deseja realmente publicar este anúncio?')) {
                // Implemente a lógica para publicar o anúncio
                console.log(`Publicar anúncio com ID: ${id}`);
                // Adicione o código para a requisição ao backend aqui
            }
        }
        
        // Função para despublicar anúncio
        function despublicarAnuncio(id) {
            if (confirm('Deseja realmente despublicar este anúncio?')) {
                // Implemente a lógica para despublicar o anúncio
                console.log(`Despublicar anúncio com ID: ${id}`);
                // Adicione o código para a requisição ao backend aqui
            }
        }
        
        // Função para excluir anúncio
        function excluirAnuncio(id) {
    if (confirm('Tem certeza que deseja excluir este anúncio?')) {
        console.log(`Excluindo anúncio com ID: ${id}`);
        
        // Mostrar o loading se existir
        const loadingOverlay = document.getElementById('loading-overlay');
        if (loadingOverlay) {
            loadingOverlay.style.display = 'flex';
        }
        
        // Fazer a requisição para excluir o anúncio
        fetch(`/excluir_anuncio/${id}`, {
            method: 'DELETE',
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`Erro na requisição: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log('Resposta do servidor:', data);
            
            if (data.sucesso) {
                alert('Anúncio excluído com sucesso!');
                
                // Remover o card do anúncio da página
                const anuncioCard = document.querySelector(`[data-anuncio-id="${id}"]`);
                if (anuncioCard) {
                    anuncioCard.remove();
                } else {
                    // Se não conseguir encontrar o card, recarregar a página
                    window.location.reload();
                }
            } else {
                alert(data.mensagem || 'Ocorreu um erro ao excluir o anúncio.');
            }
            
            // Esconder o loading se existir
            if (loadingOverlay) {
                loadingOverlay.style.display = 'none';
            }
        })
        .catch(error => {
            console.error('Erro ao excluir anúncio:', error);
            alert('Não foi possível excluir o anúncio. Verifique o console para mais detalhes.');
            
            // Esconder o loading se existir
            if (loadingOverlay) {
                loadingOverlay.style.display = 'none';
            }
        });
    }
}
    
        // Inicialização quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM carregado - inicializando scripts de edição');
            
            // Configurar evento para fechar o modal
            const closeModal = document.querySelector('.close-modal');
            if (closeModal) {
                closeModal.addEventListener('click', function() {
                    document.getElementById('modal-editar').style.display = 'none';
                });
            }
            
            // Fechar o modal ao clicar fora dele
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('modal-editar');
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
            
            // Configurar botão de cancelar
            const cancelarBtn = document.getElementById('cancelar-edicao');
            if (cancelarBtn) {
                cancelarBtn.addEventListener('click', function() {
                    document.getElementById('modal-editar').style.display = 'none';
                });
            }
            
            // Configurar botão de salvar
            const salvarBtn = document.getElementById('salvar-edicao');
            if (salvarBtn) {
                salvarBtn.addEventListener('click', salvarEdicao);
            }
            
            // Configurar upload de imagens
            const imageUpload = document.getElementById('edit-image-upload');
            const fileInput = document.getElementById('edit-file-input');
            
            if (imageUpload && fileInput) {
                imageUpload.addEventListener('click', function() {
                    fileInput.click();
                });
                
                fileInput.addEventListener('change', function() {
                    const files = this.files;
                    const previewContainer = document.getElementById('edit-preview-container');
                    
                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        
                        if (!file.type.match('image.*')) {
                            continue;
                        }
                        
                        const reader = new FileReader();
                        
                        reader.onload = function(e) {
                            const imagePreview = document.createElement('div');
                            imagePreview.className = 'image-preview';
                            
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            
                            const deleteButton = document.createElement('div');
                            deleteButton.className = 'delete-image';
                            deleteButton.innerHTML = '<i class="fas fa-times"></i>';
                            
                            deleteButton.addEventListener('click', function(event) {
                                event.stopPropagation();
                                imagePreview.remove();
                            });
                            
                            imagePreview.appendChild(img);
                            imagePreview.appendChild(deleteButton);
                            previewContainer.appendChild(imagePreview);
                        };
                        
                        reader.readAsDataURL(file);
                    }
                });
            }
            
            // Configurar evento de mudança de marca para carregar modelos
            const marcaSelect = document.getElementById('edit-marca');
            if (marcaSelect) {
                marcaSelect.addEventListener('change', function() {
                    const marca = this.value;
                    console.log("Marca selecionada:", marca);
                    
                    const modeloSelect = document.getElementById('edit-modelo');
                    if (!modeloSelect) {
                        console.error("Select de modelo não encontrado!");
                        return;
                    }
                    
                    // Limpar opções existentes
                    modeloSelect.innerHTML = '<option value="">Selecione o modelo</option>';
                    
                    if (!marca) return;
                    
                    // Adicionar modelos com base na marca selecionada
                    const modelosPorMarca = {
                        chevrolet: ['Onix', 'Cruze', 'S10', 'Tracker', 'Prisma', 'Camaro'],
                        fiat: ['Uno', 'Palio', 'Toro', 'Strada', 'Argo', 'Cronos', 'Mobi'],
                        ford: ['Ka', 'Fiesta', 'Focus', 'Ranger', 'EcoSport', 'Edge'],
                        honda: ['Civic', 'City', 'Fit', 'HR-V', 'WR-V', 'CR-V'],
                        hyundai: ['HB20', 'Creta', 'Tucson', 'i30', 'Santa Fe'],
                        toyota: ['Corolla', 'Yaris', 'Hilux', 'RAV4', 'SW4', 'Etios'],
                        volkswagen: ['Gol', 'Polo', 'Golf', 'T-Cross', 'Voyage', 'Virtus', 'Jetta']
                    };
                    
                    const modelos = modelosPorMarca[marca] || [];
                    console.log("Carregando modelos para a marca:", modelos);
                    
                    modelos.forEach(modelo => {
                        const option = document.createElement('option');
                        option.value = modelo.toLowerCase();
                        option.text = modelo;
                        modeloSelect.appendChild(option);
                    });
                });
            }
        });
    </script>
</body>
</html>